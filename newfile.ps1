#powershell -ExecutionPolicy Bypass -File "C:\Path\script.ps1"
$Script = @'
try {
    
    $userPath = [Environment]::GetFolderPath('UserProfile') + "\logs"
    New-Item -ItemType directory -Path $userPath
    # Ensure the folder exists (it should by default)
    if (-not (Test-Path $userPath)) {
        throw "Location folder not found at: $userPath"
    }

    # Create a new text file named MyFile.txt
    $filePath = Join-Path $userPath "dl.log"
    New-Item -Path $filePath -ItemType File -Force | Out-Null
    Write-Host "File created successfully at: $filePath"
    
    Write-Host "Installing NuGet" -ForegroundColor Blue
    Install-PackageProvider -Name NuGet -MinimumVersion 2.8.5.021 -Force
    Write-Host "Installing PsWindowsUpdate" -ForegroundColor Blue
    Install-Module -Name PSWindowsUpdate -Force
    Write-Host "Importing Module" -ForegroundColor Blue
    Import-Module -Name PSWindowsUpdate -Force    
    
    Write-Host "Add windows service" -ForegroundColor Blue
    Add-WUServiceManager -ServiceID "7971f918-a847-4430-9279-4a52d1efe18d" -Confirm:$false
    
    Write-Host "Get windows update" -ForegroundColor Blue
    Get-WindowsUpdate

    Write-Host "Install windows update" -ForegroundColor Blue
    Install-WindowsUpdate -Install -AcceptAll 
    
    Write-Host "Install all driver updates" -ForegroundColor Blue
    Install-WindowsUpdate -Install -AcceptAll -UpdateType Driver -MicrosoftUpdate -ForceDownload -ForceInstall -IgnoreReboot -ErrorAction SilentlyContinue | Out-File $filePath -Force
    Install-WindowsUpdate -Install -AcceptAll -UpdateType Driver -MicrosoftUpdate -ForceDownload -ForceInstall -IgnoreReboot -ErrorAction SilentlyContinue | Out-File $filePath -Force
    Write-Host "Done" -ForegroundColor Blue
}
catch {
    Write-Host "Error: $($_.Exception.Message)" -ForegroundColor Red
}
'@

$EncodedScript = [Convert]::ToBase64String([Text.Encoding]::Unicode.GetBytes($Script))
$EncodedScript

# OUTPUT dAByAHkAIAB7AA0ACgAgACAAIAAgAA0ACgAgACAAIAAgACQAdQBzAGUAcgBQAGEAdABoACAAPQAgAFsARQBuAHYAaQByAG8AbgBtAGUAbgB0AF0AOgA6AEcAZQB0AEYAbwBsAGQAZQByAFAAYQB0AGgAKAAnAFUAcwBlAHIAUAByAG8AZgBpAGwAZQAnACkAIAArACAAIgBcAGwAbwBnAHMAIgANAAoAIAAgACAAIABOAGUAdwAtAEkAdABlAG0AIAAtAEkAdABlAG0AVAB5AHAAZQAgAGQAaQByAGUAYwB0AG8AcgB5ACAALQBQAGEAdABoACAAJAB1AHMAZQByAFAAYQB0AGgADQAKACAAIAAgACAAIwAgAEUAbgBzAHUAcgBlACAAdABoAGUAIABmAG8AbABkAGUAcgAgAGUAeABpAHMAdABzACAAKABpAHQAIABzAGgAbwB1AGwAZAAgAGIAeQAgAGQAZQBmAGEAdQBsAHQAKQANAAoAIAAgACAAIABpAGYAIAAoAC0AbgBvAHQAIAAoAFQAZQBzAHQALQBQAGEAdABoACAAJAB1AHMAZQByAFAAYQB0AGgAKQApACAAewANAAoAIAAgACAAIAAgACAAIAAgAHQAaAByAG8AdwAgACIATABvAGMAYQB0AGkAbwBuACAAZgBvAGwAZABlAHIAIABuAG8AdAAgAGYAbwB1AG4AZAAgAGEAdAA6ACAAJAB1AHMAZQByAFAAYQB0AGgAIgANAAoAIAAgACAAIAB9AA0ACgANAAoAIAAgACAAIAAjACAAQwByAGUAYQB0AGUAIABhACAAbgBlAHcAIAB0AGUAeAB0ACAAZgBpAGwAZQAgAG4AYQBtAGUAZAAgAE0AeQBGAGkAbABlAC4AdAB4AHQADQAKACAAIAAgACAAJABmAGkAbABlAFAAYQB0AGgAIAA9ACAASgBvAGkAbgAtAFAAYQB0AGgAIAAkAHUAcwBlAHIAUABhAHQAaAAgACIAZABsAC4AbABvAGcAIgANAAoAIAAgACAAIABOAGUAdwAtAEkAdABlAG0AIAAtAFAAYQB0AGgAIAAkAGYAaQBsAGUAUABhAHQAaAAgAC0ASQB0AGUAbQBUAHkAcABlACAARgBpAGwAZQAgAC0ARgBvAHIAYwBlACAAfAAgAE8AdQB0AC0ATgB1AGwAbAANAAoAIAAgACAAIABXAHIAaQB0AGUALQBIAG8AcwB0ACAAIgBGAGkAbABlACAAYwByAGUAYQB0AGUAZAAgAHMAdQBjAGMAZQBzAHMAZgB1AGwAbAB5ACAAYQB0ADoAIAAkAGYAaQBsAGUAUABhAHQAaAAiAA0ACgAgACAAIAAgAA0ACgAgACAAIAAgAFcAcgBpAHQAZQAtAEgAbwBzAHQAIAAiAEkAbgBzAHQAYQBsAGwAaQBuAGcAIABOAHUARwBlAHQAIgAgAC0ARgBvAHIAZQBnAHIAbwB1AG4AZABDAG8AbABvAHIAIABCAGwAdQBlAA0ACgAgACAAIAAgAEkAbgBzAHQAYQBsAGwALQBQAGEAYwBrAGEAZwBlAFAAcgBvAHYAaQBkAGUAcgAgAC0ATgBhAG0AZQAgAE4AdQBHAGUAdAAgAC0ATQBpAG4AaQBtAHUAbQBWAGUAcgBzAGkAbwBuACAAMgAuADgALgA1AC4AMAAyADEAIAAtAEYAbwByAGMAZQANAAoAIAAgACAAIABXAHIAaQB0AGUALQBIAG8AcwB0ACAAIgBJAG4AcwB0AGEAbABsAGkAbgBnACAAUABzAFcAaQBuAGQAbwB3AHMAVQBwAGQAYQB0AGUAIgAgAC0ARgBvAHIAZQBnAHIAbwB1AG4AZABDAG8AbABvAHIAIABCAGwAdQBlAA0ACgAgACAAIAAgAEkAbgBzAHQAYQBsAGwALQBNAG8AZAB1AGwAZQAgAC0ATgBhAG0AZQAgAFAAUwBXAGkAbgBkAG8AdwBzAFUAcABkAGEAdABlACAALQBGAG8AcgBjAGUADQAKACAAIAAgACAAVwByAGkAdABlAC0ASABvAHMAdAAgACIASQBtAHAAbwByAHQAaQBuAGcAIABNAG8AZAB1AGwAZQAiACAALQBGAG8AcgBlAGcAcgBvAHUAbgBkAEMAbwBsAG8AcgAgAEIAbAB1AGUADQAKACAAIAAgACAASQBtAHAAbwByAHQALQBNAG8AZAB1AGwAZQAgAC0ATgBhAG0AZQAgAFAAUwBXAGkAbgBkAG8AdwBzAFUAcABkAGEAdABlACAALQBGAG8AcgBjAGUAIAAgACAAIAANAAoAIAAgACAAIAANAAoAIAAgACAAIABXAHIAaQB0AGUALQBIAG8AcwB0ACAAIgBBAGQAZAAgAHcAaQBuAGQAbwB3AHMAIABzAGUAcgB2AGkAYwBlACIAIAAtAEYAbwByAGUAZwByAG8AdQBuAGQAQwBvAGwAbwByACAAQgBsAHUAZQANAAoAIAAgACAAIABBAGQAZAAtAFcAVQBTAGUAcgB2AGkAYwBlAE0AYQBuAGEAZwBlAHIAIAAtAFMAZQByAHYAaQBjAGUASQBEACAAIgA3ADkANwAxAGYAOQAxADgALQBhADgANAA3AC0ANAA0ADMAMAAtADkAMgA3ADkALQA0AGEANQAyAGQAMQBlAGYAZQAxADgAZAAiACAALQBDAG8AbgBmAGkAcgBtADoAJABmAGEAbABzAGUADQAKACAAIAAgACAADQAKACAAIAAgACAAVwByAGkAdABlAC0ASABvAHMAdAAgACIARwBlAHQAIAB3AGkAbgBkAG8AdwBzACAAdQBwAGQAYQB0AGUAIgAgAC0ARgBvAHIAZQBnAHIAbwB1AG4AZABDAG8AbABvAHIAIABCAGwAdQBlAA0ACgAgACAAIAAgAEcAZQB0AC0AVwBpAG4AZABvAHcAcwBVAHAAZABhAHQAZQANAAoADQAKACAAIAAgACAAVwByAGkAdABlAC0ASABvAHMAdAAgACIASQBuAHMAdABhAGwAbAAgAHcAaQBuAGQAbwB3AHMAIAB1AHAAZABhAHQAZQAiACAALQBGAG8AcgBlAGcAcgBvAHUAbgBkAEMAbwBsAG8AcgAgAEIAbAB1AGUADQAKACAAIAAgACAASQBuAHMAdABhAGwAbAAtAFcAaQBuAGQAbwB3AHMAVQBwAGQAYQB0AGUAIAAtAEkAbgBzAHQAYQBsAGwAIAAtAEEAYwBjAGUAcAB0AEEAbABsACAADQAKACAAIAAgACAADQAKACAAIAAgACAAVwByAGkAdABlAC0ASABvAHMAdAAgACIASQBuAHMAdABhAGwAbAAgAGEAbABsACAAZAByAGkAdgBlAHIAIAB1AHAAZABhAHQAZQBzACIAIAAtAEYAbwByAGUAZwByAG8AdQBuAGQAQwBvAGwAbwByACAAQgBsAHUAZQANAAoAIAAgACAAIABJAG4AcwB0AGEAbABsAC0AVwBpAG4AZABvAHcAcwBVAHAAZABhAHQAZQAgAC0ASQBuAHMAdABhAGwAbAAgAC0AQQBjAGMAZQBwAHQAQQBsAGwAIAAtAFUAcABkAGEAdABlAFQAeQBwAGUAIABEAHIAaQB2AGUAcgAgAC0ATQBpAGMAcgBvAHMAbwBmAHQAVQBwAGQAYQB0AGUAIAAtAEYAbwByAGMAZQBEAG8AdwBuAGwAbwBhAGQAIAAtAEYAbwByAGMAZQBJAG4AcwB0AGEAbABsACAALQBJAGcAbgBvAHIAZQBSAGUAYgBvAG8AdAAgAC0ARQByAHIAbwByAEEAYwB0AGkAbwBuACAAUwBpAGwAZQBuAHQAbAB5AEMAbwBuAHQAaQBuAHUAZQAgAHwAIABPAHUAdAAtAEYAaQBsAGUAIAAkAGYAaQBsAGUAUABhAHQAaAAgAC0ARgBvAHIAYwBlAA0ACgAgACAAIAAgAEkAbgBzAHQAYQBsAGwALQBXAGkAbgBkAG8AdwBzAFUAcABkAGEAdABlACAALQBJAG4AcwB0AGEAbABsACAALQBBAGMAYwBlAHAAdABBAGwAbAAgAC0AVQBwAGQAYQB0AGUAVAB5AHAAZQAgAEQAcgBpAHYAZQByACAALQBNAGkAYwByAG8AcwBvAGYAdABVAHAAZABhAHQAZQAgAC0ARgBvAHIAYwBlAEQAbwB3AG4AbABvAGEAZAAgAC0ARgBvAHIAYwBlAEkAbgBzAHQAYQBsAGwAIAAtAEkAZwBuAG8AcgBlAFIAZQBiAG8AbwB0ACAALQBFAHIAcgBvAHIAQQBjAHQAaQBvAG4AIABTAGkAbABlAG4AdABsAHkAQwBvAG4AdABpAG4AdQBlACAAfAAgAE8AdQB0AC0ARgBpAGwAZQAgACQAZgBpAGwAZQBQAGEAdABoACAALQBGAG8AcgBjAGUADQAKACAAIAAgACAAVwByAGkAdABlAC0ASABvAHMAdAAgACIARABvAG4AZQAiACAALQBGAG8AcgBlAGcAcgBvAHUAbgBkAEMAbwBsAG8AcgAgAEIAbAB1AGUADQAKAH0ADQAKAGMAYQB0AGMAaAAgAHsADQAKACAAIAAgACAAVwByAGkAdABlAC0ASABvAHMAdAAgACIARQByAHIAbwByADoAIAAkACgAJABfAC4ARQB4AGMAZQBwAHQAaQBvAG4ALgBNAGUAcwBzAGEAZwBlACkAIgAgAC0ARgBvAHIAZQBnAHIAbwB1AG4AZABDAG8AbABvAHIAIABSAGUAZAANAAoAfQA=
